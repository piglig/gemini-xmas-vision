# 🎄 Gemini-Xmas-Vision

[![Chinese](https://img.shields.io/badge/lang-中文-red)](README.md) [![English](https://img.shields.io/badge/lang-English-blue)](README_EN.md)

最近AR圣诞树相册挺火的，浅做了一个，分享给大家，最后祝大家圣诞节快乐！

**Gemini-Xmas-Vision** 是一个基于 WebAR 技术的互动式 3D 粒子圣诞树项目。它结合了 **Three.js** 的粒子系统与 **MediaPipe** 的手势识别技术，允许用户通过手势与虚拟圣诞树进行沉浸式交互，查看螺旋照片墙上的美好回忆。

---

## ✨ 核心功能 (Features)

1.  **粒子特效圣诞树**：
    *   完全由粒子构成的树干、树叶、彩球和顶部五角星，具有独特的流光溢彩效果。
    *   动态的“呼吸”动画和旋转光效。
2.  **AI 手势交互 (WebAR)**：
    *   **🖐️ 悬停 (Hover)**：手掌出现即可唤醒交互模式。
    *   **👋 挥手 (Wave)**：检测左右挥手动作，触发屏幕祝福语特效。
    *   **↔️ 移动 (Move)**：左右移动手掌可旋转圣诞树；上下移动可推拉摄像机视角。
    *   **👌 捏合 (Pinch)**：捏合手指（拇指与食指）可选中并放大查看照片。
3.  **智能螺旋照片墙**：
    *   照片以螺旋状悬浮在树周围。
    *   **双面显示**：照片正反面均可见，背面已做镜像修正。
    *   **智能射线检测**：捏合时优先展示手指指向的照片，否则展示距离最近的照片。
    *   **自适应布局**：根据照片的横/竖构图，自动调整展示框的比例，完美适配金边相框。
4.  **沉浸式氛围**：
    *   背景雪花飘落特效（捏合查看照片时会自动产生“子弹时间”慢动作效果）。
    *   集成背景音乐控制。

---

## 🚀 快速启动 (Quick Start)

由于浏览器安全策略 (CORS) 和摄像头权限限制，本项目**不能**直接双击 `index.html` 打开，必须通过本地服务器运行。

### 1. 启动本地服务器
本项目提供多种启动方式，你可以选择最适合你的方式：

#### 方式一：使用 VS Code Live Server 插件（推荐）
如果你使用 VS Code，可以安装并使用 `Live Server` 插件，它能提供更好的开发体验：
1. 在 VS Code 中安装 `Live Server` 插件。
2. 打开 `index.html` 文件，右键点击，选择 `Open with Live Server`。

#### 方式二：使用 Python 启动一个简单的 HTTP 服务器
确保已安装 Python 3，在项目根目录下运行：

```bash
# 启动一个简单的 HTTP 服务器，端口 8080
python3 -m http.server 8080
```

#### 方式三：运行 Python 后端程序
如果你需要后端服务（例如，处理一些额外的逻辑），可以运行 `app.py`：

```bash
python app.py
```

### 2. 访问项目
打开浏览器（推荐 Chrome 或 Safari）访问：
**[http://localhost:8080](http://localhost:8080)**

### 3. 授予权限
首次打开时, 浏览器会询问摄像头权限, 请点击 **“允许”**。

---

## 🌐 CDN 配置 (CDN Configuration)

本项目使用 `config.json` 文件来控制 CDN 资源的加载策略。根据你的网络环境和使用场景，可以修改 `cdn_region` 字段来选择不同的资源来源。

打开项目根目录下的 `config.json` 文件，你可以看到类似以下内容：

```json
{
    "cdn_region": "LOCAL",
    "note": "Set cdn_region to 'CN' for China, 'GLOBAL' for international, or 'LOCAL' for offline use."
}
```

`cdn_region` 支持以下三个值：

*   **`"GLOBAL"` (国际 CDN)**：
    *   **用途**：适用于中国大陆以外的地区。
    *   **说明**：使用 `cdnjs.cloudflare.com` 和 `cdn.jsdelivr.net` 等国际主流 CDN 加载资源，这些服务在全球范围内访问速度较快且稳定。
*   **`"CN"` (中国大陆 CDN)**：
    *   **用途**：适用于中国大陆地区的用户。
    *   **说明**：使用 `cdn.bootcdn.net` 和 `npm.elemecdn.com` 等国内 CDN 加载资源。这些 CDN 针对中国大陆的网络环境进行了优化，访问速度通常更快。**注意：在非中国大陆地区访问这些 CDN 可能会遇到 403 错误或连接问题。**
*   **`"LOCAL"` (本地缓存)**：
    *   **用途**：完全离线运行或解决 CDN 访问问题时使用。
    *   **说明**：所有必要的 Three.js 和 MediaPipe 资源都会从项目本地的 `libs/` 文件夹中加载。这提供了最佳的稳定性和离线可用性，完全不受网络波动或 CDN 访问限制的影响。

**建议：**
*   如果你不确定应选择哪种模式，或者经常遇到网络问题，强烈建议使用 **`"LOCAL"`** 模式，它能确保项目最稳定的运行。
*   在非中国大陆地区开发和部署时，推荐使用 `"GLOBAL"` 或 `"LOCAL"`。
*   为中国大陆用户部署时，如果确保 `CN` CDN 可用，可以使用 `"CN"` 以获得最佳体验；否则，也建议使用 `"LOCAL"`。

---

## 🖼️ 图片资源管理


本项目支持自动读取 `assets` 文件夹中的图片。

### 添加图片步骤：
1.  将你的照片（jpg/png/heic）放入 `assets/` 文件夹。
2.  运行提供的自动重命名脚本（Mac/Linux）：
    ```bash
    # 赋予执行权限（仅需一次）
    chmod +x rename_assets.sh
    
    # 运行脚本
    ./rename_assets.sh
    ```
    *该脚本会自动将图片重命名为 `1.jpg`, `2.jpg` 等序列，供程序自动读取。*
3.  刷新网页即可看到新的照片墙。

---

## 🎮 操作指南 (User Guide)

| 手势 | 图标 | 功能描述 |
| :--- | :---: | :--- |
| **手掌张开** | ✋ | **激活交互**：出现黄色光标，跟随手部移动。 |
| **左右移动** | ↔️ | **旋转视角**：查看圣诞树的不同侧面。 |
| **上下移动** | ↕️ | **缩放视角**：拉近或推远摄像机。 |
| **左右挥手** | 👋 | **发送祝福**：触发 "Merry Christmas" 等祝福语特效。 |
| **拇指食指捏合** | 👌 | **查看照片**：<br>1. 指向某张照片捏合 -> 打开该照片。<br>2. 在空处捏合 -> 打开最近的照片。<br>保持捏合状态可锁定查看，松开后恢复。 |

---

## ⚠️ 注意事项 (Precautions)

1.  **摄像头权限与安全**：
    *   WebAR 必须在 **Localhost** (本地) 或 **HTTPS** (线上) 环境下运行。
    *   如果部署到局域网其他电脑访问（如 `http://192.168.x.x:8080`），浏览器可能会因为非 HTTPS 而拦截摄像头。
2.  **光线环境**：
    *   请在光线充足的环境下使用，逆光或过暗可能导致手势识别不稳定（光标抖动或消失）。
3.  **性能优化**：
    *   项目包含约 8000+ 粒子渲染。如果设备发热严重或卡顿，可尝试在代码 `CONFIG` 中降低 `particleCount` (树叶) 或 `snowflakeCount` (雪花) 的数量。
4.  **图片格式**：
    *   脚本默认处理 `.jpg`, `.png`, `.heic` 等格式，并统一重命名为 `.jpg` 后缀供网页读取。这在现代浏览器中通常兼容性良好。

---

## 🛠️ 技术栈
*   **Three.js**: 3D 渲染引擎 (粒子系统、材质、场景管理)。
*   **MediaPipe Hands**: Google 的机器学习框架，用于实时的手部关键点追踪。
*   **HTML5/CSS3**: UI 界面与覆盖层布局。

---
*Created on December 6, 2025*
